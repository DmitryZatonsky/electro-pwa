<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Шпаргалка Электрика</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="image/icon.png">
    <link rel="shortcut icon" href="image/icon.png">
    <link rel="apple-touch-icon" href="image/icon.png">
    <meta name="theme-color" content="#0056b3">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <section id="homeScreen" class="screen active">
            <h1>⚡ Шпаргалка Электрика</h1>
            <p id="appVersion" class="app-version">Версия: определяется...</p>
            <div class="card menu-card">
                <button type="button" class="menu-btn" data-screen="wireScreen">Расчет сечения провода и номинал автомата</button>
                <button type="button" class="menu-btn" data-screen="objectScreen">Расчет мощности объекта</button>
                <button type="button" class="menu-btn" data-screen="shieldScreen">Подбор модулей для вводного распределительного щита</button>
                <button type="button" class="menu-btn" data-screen="hybridScreen">Подбор гибридного инвертора и АКБ</button>
            </div>
        </section>

        <section id="wireScreen" class="screen">
            <button type="button" class="back-btn" data-screen="homeScreen">Назад</button>

            <div class="card result-card" id="resultBlock" style="display: none;">
                <h2>Фактическая нагрузка:</h2>
                <p>Расчетный ток: <strong id="resCurrent">-</strong></p>
                <p>Расчетная мощность: <strong id="resPower">-</strong></p>
                <hr>
                <h2>Рекомендуемая защита:</h2>
                <p>Номинал автомата: <strong id="resBreaker" class="highlight">-</strong></p>
                <p>Сечение провода: <strong id="resCable" class="highlight">-</strong></p>
                <hr>
                <h2>Параметры провода:</h2>
                <p>Допустимый ток: <strong id="resMaxCurrent">-</strong></p>
                <p>Макс. мощность: <strong id="resMaxPower">-</strong></p>
                <p>Запас по току: <strong id="resMargin" style="color: #28a745;">-</strong></p>

                <div id="dropResultBlock" style="display: none;">
                    <hr>
                    <h2>Падение напряжения:</h2>
                    <p>Потери в вольтах: <strong id="resDropVolts">-</strong></p>
                    <p>Потери в %: <strong id="resDropPercent" style="font-size: 20px;">-</strong></p>
                </div>
            </div>

            <div class="card">
                <div class="input-group">
                    <label>Тип сети</label>
                    <select id="netType">
                        <option value="AC1">Переменный (1 фаза / 230 В)</option>
                        <option value="AC3">Переменный (3 фазы / 400 В)</option>
                        <option value="DC">Постоянный (DC)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Напряжение</label>
                    <div id="voltageWrapper">
                        <input type="text" id="voltageFixed" value="230 В" readonly style="background-color: #e9ecef;">
                        <select id="voltageSelect" style="display: none;">
                            <option value="12">12 В</option>
                            <option value="24">24 В</option>
                            <option value="36">36 В</option>
                            <option value="48">48 В</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label>Материал кабеля</label>
                    <select id="material">
                        <option value="Cu">Медь (Cu)</option>
                        <option value="Al">Алюминий (Al)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Прокладка кабеля</label>
                    <select id="routing">
                        <option value="air">Открыто (в воздухе)</option>
                        <option value="pipe">В трубе/штробе</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Что известно? (Мощность / Ток)</label>
                    <select id="inputType">
                        <option value="power">Мощность (кВт)</option>
                        <option value="current">Ток (А)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label id="inputValueLabel">Значение</label>
                    <input type="number" id="inputValue" placeholder="Например: 5,5">
                </div>

                <div class="input-group" style="margin-top: 20px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="calcDropCheck" style="width: auto; margin-right: 10px;">
                        Учесть длину провода?
                    </label>
                </div>

                <div class="input-group" id="lengthGroup" style="display: none;">
                    <label>Длина трассы в одну сторону (метры)</label>
                    <input type="number" id="cableLength" placeholder="Например: 35">
                </div>

                <div class="input-group" id="cosPhiToggleGroup" style="margin-top: 20px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="manualCosPhiCheck" style="width: auto; margin-right: 10px;">
                        Ручной ввод cos φ?
                    </label>
                </div>

                <div class="input-group" id="cosPhiGroup" style="display: none;">
                    <label>cos φ</label>
                    <input type="number" id="cosPhiInput" value="0.85" min="0.01" max="1" step="0.01" placeholder="Например: 0.85">
                </div>

                <button id="calcBtn" type="button">Рассчитать</button>
            </div>
        </section>

        <section id="objectScreen" class="screen">
            <button type="button" class="back-btn" data-screen="homeScreen">Назад</button>

            <div class="card">
                <h2 style="margin-top: 0;">Расчет мощности объекта</h2>
                <p class="hint">Нажмите на потребителя, чтобы добавить его в список внизу. Расчет выполняется только по выбранным.</p>
                <div id="consumerRooms"></div>
            </div>

            <div class="card" id="selectedConsumersBlock" style="display: none;">
                <h3 class="room-title">Выбранные потребители</h3>
                <div id="selectedConsumers"></div>
                <div class="input-group" style="margin-top: 12px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="includeConsumablesCheck" style="width: auto; margin-right: 10px;">
                        Добавить расходники (оценка)
                    </label>
                </div>
                <button id="calcObjectBtn" type="button">Посчитать мощность объекта</button>
            </div>

            <div class="card result-card" id="objectResult" style="display: none;">
                <h2>Итоги по объекту:</h2>
                <p>Пиковая мощность (все включено): <strong id="resPeakPower" class="highlight">-</strong></p>
                <p>Расчетная мощность (коэф. одновременности 0.6): <strong id="resDiversityPower" class="highlight">-</strong></p>
                <p>Оценочный ток при 230 В: <strong id="resObjectCurrent">-</strong></p>
                <p>Рекомендуемый вводной автомат: <strong id="resObjectBreaker">-</strong></p>
            </div>

            <div class="card" id="objectDetailCard" style="display: none;">
                <h2 style="margin-top: 0;">Расчет по линиям</h2>
                <div class="line-table-wrap">
                    <table class="line-table">
                        <thead>
                            <tr>
                                <th>Наименование</th>
                                <th>Нагрузка</th>
                                <th>Длина, м</th>
                                <th>Сечение</th>
                                <th>Автомат</th>
                                <th>Падение, %</th>
                            </tr>
                        </thead>
                        <tbody id="objectDetailRows"></tbody>
                    </table>
                </div>
            </div>

            <div class="card" id="materialsCard" style="display: none;">
                <h2 style="margin-top: 0;">Материалы</h2>
                <ul id="materialsList" class="materials-list"></ul>
            </div>
        </section>

        <section id="shieldScreen" class="screen">
            <button type="button" class="back-btn" data-screen="homeScreen">Назад</button>

            <div class="card">
                <h2 style="margin-top: 0;">Подбор модулей вводного щита</h2>
                <p class="hint">Выберите, что известно: сечение вводного кабеля или расчетная мощность.</p>

                <div class="input-group">
                    <label>Что известно? (Сечение / Мощность)</label>
                    <select id="shieldInputBasis">
                        <option value="section">Сечение вводного кабеля</option>
                        <option value="power">Расчетная мощность</option>
                    </select>
                </div>

                <div class="input-group" id="shieldSectionGroup">
                    <label>Сечение вводного кабеля (мм²)</label>
                    <input type="number" id="shieldCableSection" min="1" step="0.5" placeholder="Например: 10">
                </div>

                <div class="input-group" id="shieldPowerGroup" style="display: none;">
                    <label>Расчетная мощность (кВт)</label>
                    <input type="number" id="shieldPowerKw" min="0.1" step="0.1" placeholder="Например: 12.5">
                </div>

                <div class="input-group">
                    <label>Количество фаз</label>
                    <select id="shieldPhases">
                        <option value="1">1 фаза (230 В)</option>
                        <option value="3">3 фазы (400 В)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Материал вводного кабеля</label>
                    <select id="shieldMaterial">
                        <option value="Cu">Медь (Cu)</option>
                        <option value="Al">Алюминий (Al)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Прокладка вводного кабеля</label>
                    <select id="shieldRouting">
                        <option value="air">Открыто (в воздухе)</option>
                        <option value="pipe">В трубе/штробе</option>
                    </select>
                </div>

                <button id="calcShieldBtn" type="button">Рассчитать вводной комплект</button>
            </div>

            <div class="card result-card" id="shieldResult" style="display: none;">
                <h2>Рекомендуемые устройства:</h2>
                <p>Вводной автомат: <strong id="resShieldBreaker" class="highlight">-</strong></p>
                <p>Реле напряжения: <strong id="resShieldRelay">-</strong></p>
                <p>УЗО вводное: <strong id="resShieldRcd">-</strong></p>
                <hr>
                <h2>Модули:</h2>
                <p>Итого модулей: <strong id="resShieldTotalModules" class="highlight">-</strong></p>
                <p>Рекомендуемый размер щита: <strong id="resShieldBoardSize" class="highlight">-</strong></p>
            </div>

            <div class="card">
                <h3 class="room-title">Основные линии</h3>
                <p class="hint">Нажмите на линию, чтобы добавить ее защиту в модули щита.</p>
                <div id="shieldMainRooms"></div>
            </div>
            
            <div class="card">
                <h3 class="room-title">Добавляемые модули</h3>
                <div id="shieldExtraModulesList" style="margin-top: 8px;"></div>
                <button id="recalcShieldBtn" type="button">Рассчитать</button>
            </div>

            <div class="card" id="shieldEquipmentCard" style="display: none;">
                <h2 style="margin-top: 0;">Список закупки</h2>
                <table class="equipment-table">
                    <thead>
                        <tr>
                            <th>Наименование</th>
                            <th>Количество</th>
                        </tr>
                    </thead>
                    <tbody id="shieldEquipmentRows"></tbody>
                </table>
            </div>

        </section>

        <section id="hybridScreen" class="screen">
            <button type="button" class="back-btn" data-screen="homeScreen">Назад</button>

            <div class="card">
                <h2 style="margin-top: 0;">Подбор гибридного инвертора и АКБ</h2>
                <p class="hint">Расчет выполнен по потреблению и времени автономии. Для точного подбора учитывайте пусковые токи и реальные режимы нагрузки.</p>

                <div class="input-group">
                    <label>Что известно?</label>
                    <select id="hybridConsumptionBasis">
                        <option value="daily">Суточное потребление (кВт·ч/сутки)</option>
                        <option value="monthly">Месячное потребление (кВт·ч/месяц)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label id="hybridEnergyLabel">Суточное потребление (кВт·ч)</label>
                    <input type="number" id="hybridEnergyValue" min="0.1" step="0.1" placeholder="Например: 18">
                </div>

                <div class="input-group">
                    <label>Желаемое время автономии (ч)</label>
                    <input type="number" id="hybridAutonomyHours" min="0.5" step="0.5" placeholder="Например: 8">
                </div>

                <div class="input-group">
                    <label>Номинальное напряжение АКБ (В)</label>
                    <select id="hybridBatteryVoltage">
                        <option value="24">24 В</option>
                        <option value="48" selected>48 В</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Тип АКБ</label>
                    <select id="hybridBatteryType">
                        <option value="lifepo4">LiFePO4</option>
                        <option value="agm">AGM/GEL (свинцово-кислотные)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Запас по мощности инвертора (%)</label>
                    <input type="number" id="hybridInverterReserve" min="0" max="200" step="5" value="30">
                </div>

                <div class="input-group">
                    <label>Пиковая нагрузка, если известна (кВт)</label>
                    <input type="number" id="hybridPeakLoadKw" min="0" step="0.1" placeholder="Необязательно">
                </div>

                <button id="calcHybridBtn" type="button">Рассчитать подбор</button>
            </div>

            <div class="card result-card" id="hybridResult" style="display: none;">
                <h2>Рекомендации:</h2>
                <p>Приведенное суточное потребление: <strong id="resHybridDailyKwh" class="highlight">-</strong></p>
                <p>Средняя нагрузка: <strong id="resHybridAvgPower" class="highlight">-</strong></p>
                <p>Рекомендуемая мощность инвертора: <strong id="resHybridInverterPower" class="highlight">-</strong></p>
                <p>Рекомендованный запас по пуску: <strong id="resHybridSurgePower">-</strong></p>
                <hr>
                <h2>АКБ:</h2>
                <p>Энергия на период автономии: <strong id="resHybridAutonomyEnergy">-</strong></p>
                <p>Собственное потребление инвертора: <strong id="resHybridInverterSelfUse">-</strong></p>
                <p>Всего энергии от АКБ на автономию: <strong id="resHybridTotalAutonomyEnergy">-</strong></p>
                <p>Номинальная емкость АКБ: <strong id="resHybridBatteryEnergy" class="highlight">-</strong></p>
                <p>Требуемая емкость при выбранном напряжении: <strong id="resHybridBatteryAh" class="highlight">-</strong></p>
                <p>Минимальный остаток заряда АКБ: <strong id="resHybridMinSoc">-</strong></p>
                <p>Принятые допущения (DoD/КПД): <strong id="resHybridAssumptions">-</strong></p>
            </div>
        </section>
    </div>

    <script src="app.js"></script>
</body>
</html>
